define ("format_qmultopics/tabs",["jquery","jqueryui"],function(a){return{init:function init(){function b(b){var c=b.attr("tabindex");if(0<c){a(".section.main:visible").each(function(){a(this).attr("tabindex",c)})}}function c(){a(document).keyup(function(b){var c=b.keyCode||b.which,d=a(":focus");if(13==c){if("undefined"!=typeof d.attr("id")&&-1<d.attr("id").indexOf("tab")){d.click()}if("undefined"!=typeof d.attr("id")&&-1<d.attr("id").indexOf("section")){d.find(".toggler:visible").click()}}})}function d(b,c,d){a(".tablink").each(function(){a(this).attr("sections",a(this).attr("sections").replace(","+c,""));a(this).attr("sections",a(this).attr("sections").replace(c+",",""));a(this).attr("sections",a(this).attr("sections").replace(c,""));a(this).attr("section_nums",a(this).attr("section_nums").replace(","+d,""));a(this).attr("section_nums",a(this).attr("section_nums").replace(d+",",""));a(this).attr("section_nums",a(this).attr("section_nums").replace(d,""))});if(0<b){if(0===a("#tab"+b).attr("sections").length){a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+c)}else{a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+","+c)}if(0===a("#tab"+b).attr("section_nums").length){a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+d)}else{a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+","+d)}}}function e(b){var c=a("#courseid").attr("courseid");a.ajax({url:"format/topics2/ajax/update_tab_settings.php",type:"POST",data:{courseid:c,tabid:b,sections:a("#"+b).attr("sections"),sectionnums:a("#"+b).attr("section_nums"),sesskey:M.cfg.sesskey},success:function success(a){if(""!==a){console.log(a)}}})}var f=function(){a("#changenumsections").on("click",function(){var b=a(".section.main").length;sessionStorage.setItem("numSections",b)})},g=function(a){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.replace(/[&<>"']/g,function(a){return b[a]})},h=function(b,c,d){if(0===a(".inplaceeditingon").length){if(0<a(".inplaceeditable").length){b.find("a").html(b.find("a").html().replace(g(c),d))}else{b.html(b.html().replace(g(c),d))}}},i=function(b){if(0<a(".limittabname").length){var c=a(".limittabname").attr("value"),d=b.attr("tab_title");if(d.length>c){var e=d.substr(0,c)+String.fromCharCode(8230);if(b.hasClass("tabsectionname")){b.html(e)}else{h(b,d,e)}}}},j=function(){if(0<a(".limittabname").length){a(".tablink").each(function(){i(a(this))})}},k=function(b,c,d){if(0===a(".inplaceeditingon").length){var e=c.substr(0,d)+String.fromCharCode(8230);if(0<a(".inplaceeditable").length){var f=b.find(".inplaceeditable").attr("data-value");if(c!==f){b.attr("tab_title",f);c=f;e=c.substr(0,d)+String.fromCharCode(8230)}b.find("a").html(b.find("a").html().replace(g(e),c))}else{b.html(b.html().replace(g(e),c))}}},l=function(b){if(0<a(".limittabname").length){var c=a(".limittabname").attr("value"),d=b.attr("tab_title");if(d.length>c){if(b.hasClass("tabsectionname")){b.html(d)}else{k(b,d,c)}}}},m=function(b,c){console.log("single section in tab: using section name as tab name");var d=c.find(".sectionname:not(.hidden)");if(-1<a(".tabname_backup:visible").length){var e=c.attr("aria-label");b.parent().append(b.clone().addClass("tabname_backup").hide());b.html(e).addClass("tabsectionname");b.attr("tab_title",e);if(0===a(".inplaceeditable").length){d.hide();c.find(".sectionhead").hide()}else{c.find(".toggler").addClass("toggler_edit_only").hide();d.addClass("edit_only")}}};a(".section").on("updated",function(){var b=a(this).find(".inplaceeditable").attr("data-value");a(this).attr("aria-label",b);a(".tablink.active").click()});var n=function(b){var c=b.attr("id");b.addClass("hidden-tab");require(["core/str"],function(d){var e=d.get_string("hidden_tab_hint","format_qmultopics");a.when(e).done(function(d){b.find("#not-shown-hint-"+c).remove();var e="<i id=\"not-shown-hint-"+c+"\" class=\"fa fa-info\" title=\""+d+"\"></i>";if(1==b.attr("sections").split(",").length&&0<a(".single_section_tabs").length){b.html(b.html()+" "+e)}else if(0<a(".tablink .fa-pencil").length){b.find(".inplaceeditable").append(e)}else{b.html(b.html()+" "+e)}})})},o=function(b){var c=b.attr("id");b.removeClass("hidden-tab");a("#not-shown-hint-"+c).remove()},p=function(b){var c=b.parent().find(".tabname_backup"),d=b.parent().find(".tabsectionname").removeClass("tabsectionname");d.html(c.html());c.remove();a(".sectionname").removeClass("edit_only").show();a(".hidden.sectionname").show();a(".section-handle").show();a(".toggler_edit_only").removeClass("toggler_edit_only").show();console.log("--> restoring section headline ")},q=function(){a(".tablink").on("click",function(){var c=a("#courseid").attr("courseid"),d=a(this).attr("id"),e=a(this).attr("sections"),f=e.split(",");a(".tablink.active").removeClass("active");a(this).addClass("active");sessionStorage.setItem("courseid",c);sessionStorage.setItem("tabid",d);if(0<a(".limittabname").length){j();l(a(this))}var g;if(a(this).find(".inplaceeditable-text")){g=a(this).find(".inplaceeditable-text").attr("data-value")}if("undefined"==typeof g){g=a(this).html()}console.log("=====> Clicked tab \""+g+"\":");a(".assessment_info_block_content").hide();a(".tablink.active").removeClass("active");a(".modulecontent").addClass("active");a("#content_assessmentinformation_area").hide();a("#assessment_information_summary").hide();a("#assessment_information_area").hide();if("tab0"===d){a("#changenumsections").show();a("li.section").removeClass("hidden").show();a(".topictab:visible").each(function(){if(0<a(this).attr("sections").length){a.each(a(this).attr("sections").split(","),function(b,c){var d=a(".section[section-id='"+c+"']");d.addClass("hidden").hide();console.log("--> hiding section "+c)})}})}else if("tab_assessment_information"===d){a("li.section").addClass("hidden").hide();a("li.section.hidden").addClass("hiding");a("li.section.hiding").removeClass("hidden");a("#content_assessmentinformation_area").show();if(0<a(".merge_assessment_info").length){a("#assessment_information_summary").show();a("#assessment_information_area").show()}}else if("tab_assessment_info_block"===d){a("li.section").addClass("hidden").hide();a("#changenumsections").hide();a("li.section.hidden").addClass("hiding");a("li.section.hiding").removeClass("hidden");a("#assessment_information_summary").show();a("#assessment_information_area").show()}else{a("#changenumsections").show();a("li.section").addClass("hidden").hide();a.each(f,function(b,c){var d=a(".section[section-id='"+c+"']");d.removeClass("hidden").show();console.log("--> showing section "+c)})}a("#ontop_area #section-0").removeClass("hidden").show();var h=a("li.section:visible").length,i=a("li.section:visible").find(".ishidden").length,k=a("#modulecontent").find(".block:visible"),q=a("#content_assessmentinformation_area:visible").length;if(0<a(".section0_ontop").length){console.log("section0 is on top - so reducing the number of visible sections for this tab by 1");h--}if(1>h&&0===k.length&&0===q){console.log("tab with no visible sections - hiding it");a(this).parent().hide();var r=a(this).attr("generic_title");a.ajax({url:"format/topics2/ajax/update_tab_name.php",type:"POST",data:{courseid:c,tabid:d,tab_name:r,sesskey:M.cfg.sesskey},success:function success(b){if(""!==b){console.log("Reset name of tab ID "+d+" to \""+b+"\"");a("[data-itemid="+b+"]").attr("data-value",r).find(".quickeditlink").html(r);x()}}})}else{console.log("tab with visible sections - showing it");a(this).parent().show()}if(0<a(".single_section_tabs").length&&1==a(this).attr("sections").split(",").length&&"tab0"!==d){var s=a("li.section:visible").first();if(0<a(".section0_ontop").length){s=a("li.section:visible:eq(1)")}var t=s.attr("id");if(1>=h-i&&"section-0"!==t&&0<=a(this).attr("generic_title").indexOf("Tab")){m(a(this),s);s.find(".toggle_area").removeClass("hidden").show()}else if(0<a(".inplaceeditable").length&&"section-0"!==t){p(a(this))}}if(h<=i&&0===k.length&&0===q){n(a(this))}else{o(a(this))}if("tab0"===d&&1===a(".tabitem:visible").length){a(".tabitem").hide()}b(a(this))})},r=function(){a(".tab_mover").on("click",function(){var b=a(this).attr("tabnr"),c=a(this).closest("li.section").attr("section-id"),d=a(this).closest("li.section").attr("id").substring(8),e=a(".topictab.active").first().attr("id");if("undefined"==typeof e){e="tab0"}a(".tablink").each(function(){a(this).attr("sections",a(this).attr("sections").replace(","+c,""));a(this).attr("sections",a(this).attr("sections").replace(c+",",""));a(this).attr("sections",a(this).attr("sections").replace(c,""));a(this).attr("section_nums",a(this).attr("section_nums").replace(","+d,""));a(this).attr("section_nums",a(this).attr("section_nums").replace(d+",",""));a(this).attr("section_nums",a(this).attr("section_nums").replace(d,""))});if(0<b){if(0===a("#tab"+b).attr("sections").length){a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+c)}else{a("#tab"+b).attr("sections",a("#tab"+b).attr("sections")+","+c)}if(0===a("#tab"+b).attr("section_nums").length){a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+d)}else{a("#tab"+b).attr("section_nums",a("#tab"+b).attr("section_nums")+","+d)}}a("#tab"+b).click();a("#"+e).click();p(a("#tab"+b));var f=a("li.section:visible").length-(a("#ontop_area").hasClass("section0_ontop")?1:0);if(0<f&&a("li.section:visible").length>=f){a("#tab"+b).click();a("#"+e).click()}else{a("#tab"+b).click();a("#"+e).parent().hide()}})},s=function(){a(".ontop_mover").on("click",function(){a("ul#ontop_area").append(a(this).closest(".section")).addClass("section0_ontop");a("#section-0").removeClass("main")})},t=function(){a(".inline_mover").on("click",function(){var b=a(this).closest(".section").attr("section-id");a("#inline_area").append(a(this).closest(".section"));a("#section-0").addClass("main");a(".section0_ontop").removeClass("section0_ontop");a(".tablink").each(function(){if(-1<a(this).attr("sections").indexOf(b)){a(this).click();return!1}return!1})})},u=function(){a(".menubar").on("click",function(){if(a(this).parent().parent().hasClass("section_action_menu")){var b=a(this).closest(".section").attr("id");a("#"+b+" .tab_mover").show();var c=[],d=[];a(".tablink").each(function(){if("undefined"!=typeof a(this).attr("id")){var b="",e=a(this).attr("id").substr(3);if(a(this).hasClass("tabsectionname")){b=a(this).html()}else{b=a(this).find(".inplaceeditable").attr("data-value")}if(0>a.inArray(e,d)){if(a(this).hasClass("hidden-tab")){b=a(this).find("a").clone();b.find("span.quickediticon").remove();b=a.trim(b.html())}c[e]=b;d.push(e)}}});a(this).parent().find(".tab_mover").each(function(){var b=a(this).attr("tabnr"),d="To Tab "+(""===c[b]||c[b]==="Tab "+b?b:"\""+c[b]+(c[b]==="Tab "+b||"0"===b?"\"":"\" (Tab "+b+")"));a(this).find(".menu-action-text").html(d)});if("section-0"===b){if(1===a("#ontop_area.section0_ontop").length){a("#section-0 .inline_mover").show();a("#section-0 .tab_mover").addClass("tab_mover_bak").removeClass("tab_mover").hide();a("#section-0 .ontop_mover").hide()}else{a("#section-0 .inline_mover").hide();a("#section-0 .tab_mover_bak").addClass("tab_mover").removeClass("tab_mover_bak").show();a("#section-0 .ontop_mover").show()}}else if("undefined"!=typeof a(".tablink.active").attr("id")){var e=a(".tablink.active").attr("id").substring(3);a("#"+b+" .tab_mover[tabnr=\""+e+"\"]").hide()}if(0===a(".tablink:visible").length){a("#"+b+" .tab_mover[tabnr=\"0\"]").hide()}}})},v=function(){a(".section-actions .menubar .action-menu-trigger .dropdown .dropdown-menu .dropdown-item").on("click",function(){var b=a(".tablink.active"),c=a("li.section:visible").length,d=a("li.section:visible").find(".ishidden").length,e=a("#modulecontent").find(".block:visible"),f=a("#content_assessmentinformation_area:visible").length;if(0<=a(this).find(".menu-action-text").html().indexOf("Hide")){if(b.attr("id")!=void 0&&c<=d+a(".section0_ontop").length+1&&0===e.length&&0===f){n(b)}}if(0<=a(this).find(".menu-action-text").html().indexOf("Show")){if(b.attr("id")!=void 0){o(b)}}})},w=function(){a("a").click(function(){if("#"!==a(this).attr("href")&&"undefined"!=typeof a(this).attr("href")){var b=a(this).attr("href").split("#")[1];if("undefined"!=typeof b){var c=a("#"+b).attr("section-id"),d=!1;a(".tablink").each(function(){if(-1<a(this).attr("sections").indexOf(c)){a(this).click();d=!0;return!1}});if(!d){a("#tab0").click()}}}})},x=function(){q();r();s();t();u();f();c();v();w()},y=function(b,c){var d=a(document).find(".course_format_name").html(),e=c.draggable.find(".topictab").first(),f=a(this).find(".topictab").first(),g=e.attr("id"),h=f.attr("id");console.log("The tab with ID \""+g+"\" was dropped onto tab with the ID \""+h+"\"");var i=e.parent().html();e.parent().html(f.parent().html());f.parent().html(i);x();var j=[];a(".tablink").each(function(){var b=a(this).attr("id");if("undefined"!=typeof b){if(!j.includes(b)){j.push(b)}}});var k=j.join(),l=a("#courseid").attr("courseid");a.ajax({url:"format/topics2/ajax/update_tab_seq.php",type:"POST",data:{courseid:l,tab_seq:k,course_format_name:d,sesskey:M.cfg.sesskey},success:function success(a){console.log("the new tab sequence: "+a)}})};a(document).ready(function(){console.log("=================< topics2/tabs.js >=================");x();if(0<a(".block_assessment_information").length){a("#assessment_information_area").append(a(".block_assessment_information"));if(a(".block").length===a(".block_assessment_information").length){a("#region-main").removeClass("has-blocks")}}a("#section-0 .right.side").show();j();if(0<a(".inplaceeditable").length){a(".topictab").parent().draggable({cursor:"move",stack:".tabitem",revert:!0});a(".topictab").parent().droppable({accept:".tabitem",hoverClass:"hovered",drop:y})}var b=a("#courseid").attr("courseid"),c=sessionStorage.getItem("courseid"),f=null;if(null!==c&&c==b){f=sessionStorage.getItem("tabid")}else{sessionStorage.removeItem("courseid");sessionStorage.removeItem("tabid")}a("#tab0").click();a(".tablink:visible").click();if(0<a(".topictab:visible").length){if(null!==f&&"tab0"!=f){var g=sessionStorage.getItem("numSections");sessionStorage.removeItem("numSections");if(null!==g){var h=f.substring(3),k=0;a(".section.main").each(function(){k=k+1;if(k>g){var b=a(this).attr("section-id"),c=a(this).attr("id").substring(8);d(h,b,c)}});e(f)}a("#"+f).click()}else{a(".tablink:visible").first().click()}}if(a("#ontop_area").hasClass("section0_ontop")){a("#section-0 .inline_mover").show();a("#section-0 .tab_mover").hide();a("#section-0 .ontop_mover").hide()}else{a("#section-0 .inline_mover").hide();a("#section-0 .tab_mover").show();a("#section-0 .ontop_mover").show()}})}}});
//# sourceMappingURL=tabs.min.js.map
